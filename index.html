<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BI系统</title>
  <link rel="stylesheet" href="./styles/index.css" type="text/css">
  <link rel="stylesheet" href="./styles//data.css">
  <link rel="stylesheet" href="./styles//popup.css">
  <link rel="stylesheet" href="./styles/iconfont/iconfont.css">
</head>
<body>
  <div class="page" >
    <div class="page-tools">1</div>
    <div class="page-wrap">
      <div class="btn-groups" id="btnGroups" >
        <!-- 此处遍历生成左侧内容 -->
        <!-- <div class="l-title" >组件箱</div>     
        <div class="l-title l-subtitle">标准组件</div>
        <div class="btn" draggable="true" data-id="${index}">
          <i class="icon iconfont iconrect" ></i>
          <span>测试</span>
        </div> -->
      </div>
      <div class="canvas" id="canvas">
        <div class="wrap-tab" >test</div>
        <div class="canvas-wrap" id="canvas-wrap"  onclick="clickWrap(event)" oncontextmenu="forbidMouse(event)" >
          <div class="wrap" id="wrap" >
        <!-- 此处遍历生成画布元素 -->
          </div>
        </div>
      </div>
      <div class="details">
        <!-- 属性栏固定组 -->
        <div class="common-group" id="common-group">
          <!-- <div class="r-item" >检视: <span id="r-item-title">画布</span></div>
          <input type="text" class="r-input" value="MainCanvas" />
          <div class="r-btns">
            <div id="r-btns-style" class="active" onclick="choice('style')" >样 式</div>
            <div id="r-btns-event" onclick="choice('event')">数 据</div>
          </div> -->
          <!-- <div class="data" >
            <div class="data-func" >
              <span>功能设置</span>
                  <div class="func-variable">
                    <span class="func-wrap-title" >变量</span>
                    <div class="func-wrap-center">
                      <input type="text" class="func-wrap-input"  />
                      <span class="func-wrap-choice" >选择</span>
                    </div>
                    <span class="func-wrap-last" >1/1</span>
                  </div>
                  <div class="func-others" ><input type="checkbox" id="label1" ><label for="label1">双击时弹出历史曲线窗口</label></div>
                  <div class="func-others" ><input type="checkbox" id="label2" ><label for="label2">数值字体颜色按条件变化</label> </div>
              <div class="func-format">
                <span class="func-format-title" >显示格式</span>
                <input type="text" class="func-format-input" placeholder="整数位数" />
                <input type="text" class="func-format-input" placeholder="小数位数" />
            </div>
            </div>
          </div> -->
          <!-- <div class="pos-group" >
            <div class="r-pos aligin-style-span">
              <span>对齐方式</span>
              <div class="r-pos r-align-style">
                <i class="iconfont iconzuoduiqi" title="左对齐"></i>
                <i class="iconfont iconjuzhongduiqi" title="居中对齐"></i>
                <i class="iconfont iconyouduiqi" title="右对齐"></i>
              </div>
            </div>
          </div> -->
          <!-- <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div> -->
        </div>
        <!-- 属性栏变化组 -->
        <div class="change-group" id="change-group">
          <!-- <div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" ></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" ></div>
              <div><span>Y：</span><input class="r-pos-input" type="text" ></div>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <select id="group" class="pos-select" value="1">
                <option value="1">字体一</option>
                <option value="2">字体二</option>
              </select>
          </div>
            <div class="r-pos r-font-prop">
              <span class="f-font-blod">B</span>
              <span class="f-font-underline">U</span>
              <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur()" value="0"></span>
              <span class="r-font-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
          <div class="pos-group" >
            <div class="r-pos aligin-style-span">
              <span>对齐方式</span>
              <div class="r-pos r-align-style">
                <i class="iconfont iconzuoduiqi" title="左对齐"></i>
                <i class="iconfont iconjuzhongduiqi" title="居中对齐"></i>
                <i class="iconfont iconyouduiqi" title="右对齐"></i>
              </div>
            </div>
          </div>
          <div class="pos-others">
            <span class="pos-border">边框</span>
            <div class="font-border">
              <input type="text" class="r-pos-input" />
              <span class="font-border-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>圆角</span>
            <input type="text" class="r-pos-input" />
          </div>
          <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>不透明度(%)</span>
            <input type="text" class="r-pos-input" value="100" />
          </div> -->
          <!-- <div class="pos-others">
            <span class="pos-border">边框</span>
            <input type="text" class="r-pos-input" value="2" />
            <span class="pos-border-color"></span>
            <span class="pos-border-style"></span>
          </div> -->
          <!-- <div class="pos-others">
            <span>图片</span>
            <select id="group" class="pos-select" value="1">
              <option value="1">img1</option>
              <option value="2">img2</option>
            </select>
            <span class="pos-selectImg">...</span>
          </div> -->
        </div>
      </div>
      <!-- 鼠标右键菜单 -->
      <ul id="rightMenu">
        <li class="menu" onclick="delElement()">删 除</li>
    </ul>
    <!--拖动容器盒子的小圆点-->
    <!-- <div class="edit-shape-point"
      v-for="item in (childItem.index === activeIndex ? childItem.pointList : [])"
      :key="item"
      onmousedown="handleMouseDownOnPoint(item, $event)"
      :style="getPointStyle(item)"
    /> -->
    <!-- 弹窗部分 -->
    <div class="popup" id="popup" >
      <div class="popup-wrap" >
        <div class="popup-head">
          <span>选择关联变量</span>
          <i class="iconfont iconguanbi popup-close" onclick="closePopup(event)" ></i>
        </div>
        <div class="popup-body">
          <div class="popup-search" >
            <div>
              <select class="popup-select" placeholder="请选择" >
                <option value="1">变量来源1</option>
                <option value="2">变量来源2</option>
              </select>
              <select class="popup-select" placeholder="请选择">
                <option value="1">所属设备1</option>
                <option value="2">所属设备2</option>
              </select>
              <input class="popup-input" placeholder="变量名" type="text">
              <input class="popup-input" placeholder="描述" type="text">
            </div>
            <div>
              <button type="button" class="popup-btn popup-confirm" style="margin-right: 10px">查 询</button>
              <button type="button" class="popup-btn popup-cancel" >重 置</button>
            </div>
          </div>
          <div class="popup-table" >
            <table cellspacing="0" cellpadding="0" border="0">
              <thead>
                <tr>
                  <th rowspan="1" colspan="1"></th>
                  <th rowspan="1" colspan="1"><div>变量来源</div></th>
                  <th rowspan="1" colspan="1"><div>变量名称</div></th>
                  <th rowspan="1" colspan="1"><div>变量描述</div></th>
                  <th rowspan="1" colspan="1"><div>单位</div></th>
                  <th rowspan="1" colspan="1"><div>数据类型</div></th>
                  <th rowspan="1" colspan="1"><div>变量类型</div></th>
                  <th rowspan="1" colspan="1"><div>所属客户</div></th>
                  <th rowspan="1" colspan="1"><div>所属设备</div></th>
                  <th rowspan="1" colspan="1"><div>设备编号</div></th>
                </tr>
              </thead>
              <tbody id="popup-tbody">
                <!-- 此处遍历生成tr元素 -->
              </tbody>
            </table>
          </div>
          <div class="popup-pagination">
            <div>
              
            </div>
          </div>
        </div>
        <div class="popup-footer">
          <button type="button" class="popup-btn popup-cancel" style="margin-right: 20px" onclick="closePopup(event)" >取 消</button>
          <button type="button" class="popup-btn popup-confirm" onclick="confirmPop(event)" >确 认</button>
        </div>
      </div>
    </div>

    <div class="popup" id="additionPop" >
      <div class="popup-wrap" style="width: 600px">
        <div class="popup-head">
          <span>新增</span>
          <i class="iconfont iconguanbi popup-close" onclick="closeAddtion(event)" ></i>
        </div>
        <div class="popup-body">
          <form class="popup-form" action="">
            <div class="form-wrap" >
              <div class="form-item" >
                <span class="form-item-label" >条件：</span>
                <select class="popup-select form-input" placeholder="请选择">
                  <option value="1">所属设备1</option>
                  <option value="2">所属设备2</option>
                </select>
              </div>
              <div class="form-item">
                <span class="form-item-label" >值：</span>
                <input type="text" class="popup-input form-input">
              </div>
              <div class="form-item">
                <span class="form-item-label" > 颜色：</span>
                <div class="form-color">
                  <span class="pos-border-color" style="margin: 0" ></span>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="popup-footer">
          <button type="button" class="popup-btn popup-cancel" style="margin-right: 20px" onclick="closeAddtion(event)" >取 消</button>
          <button type="button" class="popup-btn popup-confirm">确 认</button>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    var Width = 1200
    var Height = 900
    var commonList = {
      Title: '画布',
      Name: 'MainCanvas'
    }
    var btns = [
      {
        icon: 'iconjingtaitupian-copy',
        title: '静态图片',
        ControlType: 'staticimage',
        Width: 100,
        Height: 30,
        Img: './imgs/img1.jpg',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconjingtaitupian-copy',
        title: '动态图片',
        ControlType: 'image',
        Width: 100,
        Height: 30,
        Img: './imgs/img1.jpg',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconwenben',
        title: '数值显示',
        ControlType: 'datatextblock',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        FontSize: 12,
        TextDecoration: 'none',
        Color: '#000',
        BackColor: '#fff',
        BorderWidth: 0,
        Style: 'solid',
        BorderColor: '#000',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconzhixian_huaban1',
        title: '直线',
        ControlType: 'line',
        Width: 100,
        Height: 2,
        BorderWidth: 2,
        Style: 'solid',
        BorderColor: '#000',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconrect',
        title: '矩形',
        ControlType: 'solidrectangle',
        BackColor: '#fff',
        BorderWidth: 2,
        Style: 'solid',
        BorderColor: '#000',
        Width: 100,
        Height: 30,
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconradio-on-full',
        title: '圆形',
        ControlType: 'solidellipse',
        BackColor: '#fff',
        BorderWidth: 2,
        Style: 'solid',
        BorderColor: '#000',
        Width: 100,
        Height: 30,
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconjinggao',
        title: '圆形状态灯',
        ControlType: 'ellipselamp',
        Width: 30,
        Height: 30,
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconrect',
        title: '矩形状态灯',
        ControlType: 'commonlamp',
        Width: 100,
        Height: 30,
        BorderRadius: 10,
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconwenben',
        title: '静态文本',
        ControlType: 'statictextblock',
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        FontSize: 12,
        TextDecoration: 'none',
        Color: '#000',
        Opacity: 100,
        Text: '静态文本',
        BackColor: '#fff',
        Width: 100,
        Height: 30,
        ZIndex: 10,
      },
      {
        icon: 'iconwenben',
        title: '动态文本',
        ControlType: 'dynamictext',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        FontSize: 12,
        TextDecoration: 'none',
        Color: '#000',
        Opacity: 100,
        TextAlign: 'center',
        Text: '动态文本',
        ZIndex: 10,
      },
      {
        icon: 'iconanniu',
        title: '控制按钮',
        ControlType: 'cornerbutton',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        Color: '#000',
        BackColor: '#ddd',
        FontSize: 12,
        TextAlign: 'center',
        BorderWidth: 1,
        Style: 'solid',
        BorderColor: '#000',
        BorderRadius: 10,
        Text: '控制按钮',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconShapecopy',
        title: '读写框',
        ControlType: 'rwtextbox',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        Color: '#000',
        BackColor: '#fff',
        FontSize: 12,
        TextAlign: 'center',
        BorderWidth: 1,
        Style: 'solid',
        BorderColor: '#ABADB3',
        BorderRadius: 0,
        Text: '读写框',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconlianjie',
        title: '跳转链接',
        ControlType: 'jumplink',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        FontSize: 12,
        BackColor: '#fff',
        Color: '#000',
        Text: '盛原成',
        Opacity: 100,
        ZIndex: 10,
      },
      {
        icon: 'iconchaxun',
        title: '文本查询',
        ControlType: 'textsearch',
        Width: 100,
        Height: 30,
        FontFamily: '微软雅黑',
        FontWeight: 'normal',
        FontSize: 12,
        BorderWidth: 1,
        Placeholder: '请输入关键词',
        Style: 'solid',
        BorderColor: '#ABADB3',
        BackColor: '#fff',
        TextAlign: 'left',
        Color: '#000',
        BorderRadius: 0,
        Text: '',
        Opacity: 100,
        ZIndex: 10,
      }
    ]
    var Controls = {
      ControlList: []
    }
    Controls.ControlList = [
      {
        title: '矩形',
        ControlType: 'solidrectangle',
        Name: 'solidrectangle0',
        PropertyList: {
          id: 0,
          Left: 100,
          Top: 500,
          Width: 200,
          Height: 140,
          BackColor: '#fff',
          BorderWidth: 2,
          Style: 'solid',
          BorderColor: '#000',
          Opacity: 100,
          ZIndex: 10
       },
        pointList: ['lt', 'rt', 'lb', 'rb', 'l', 'r', 't', 'b'],
      },
      {
        title: '直线',
        ControlType: 'line',
        Name: 'line1',
        PropertyList: {
          id: 1,
          Left: 400,
          Top: 200,
          Width: 100,
          BorderWidth: 5,
          height: 5,
          Style: 'solid',
          Opacity: 100,
          BorderColor: '#000',
          ZIndex: 10
       },
        pointList: ['l', 'r'],
      }
    ]
    var attrsGroup = {
      title: '444',
      Name: '',
      Width: null,
      Height: null,
      top: null,
      left: null
    }
    // 数值显示变量表格数据
    var tableData = []
    // var leg = Controls.ControlList.length === 0  ? 0 : Controls.ControlList[Controls.ControlList.length - 1].PropertyList.id
    if (Controls.ControlList.length !== 0) {
      let ids = []
      Controls.ControlList.forEach((item, index) => {
        ids.push(item.PropertyList.id)
      })
      leg = Math.max(...ids)
    } else {
      leg = 0
    }
    window.addEventListener("load",handler,false);
    var menu = document.querySelector("#rightMenu");  //获取自定义的右键菜单
    var delIndex = null
    function handler () {
      // 左侧部分拖拽源对象
      var btnGroups = document.getElementById('btnGroups')
      var str = `<div class="l-title" >组件箱</div>     
        <div class="l-title l-subtitle">标准组件</div>`  //拼接字符串
      btns.forEach((item, index) => {
        str += `<div class="btn" draggable="true" data-id="${index}">
          <i class="icon iconfont ${item.icon}" ></i>
          <span>${item.title}</span>
        </div>`
      })
      btnGroups.innerHTML = str
      initCommon()
      // dragStart事件
      btnGroups.addEventListener("dragstart",function(e){
        menu.style.display = 'none'
        if(e.target.className == "btn"){
          e.dataTransfer.setData("data", JSON.stringify(e.target.dataset.id));
          e.dataTransfer.effectAllowed = 'copyMove'
        }
      }, false)
      // drag事件
      btnGroups.addEventListener("drag",function(e){
        e.preventDefault()
      }, false)
      // 中间画布部分拖拽目标对象
      var canvasWrap = document.getElementById('canvas-wrap')
      // 初始化画布，此方法用于差看画布使用
      childElement ()
      // dragovers事件
      canvasWrap.addEventListener('dragover', function (event) {
        // event.preventDefault()
        if (event.target.classList.contains('allowed')) {
          event.dataTransfer.dropEffect = 'move'
        } else {
          event.dataTransfer.dropEffect = 'copy'
        }
        event.preventDefault()
      }, false)
      // drop事件
      canvasWrap.addEventListener('drop', function (event) {
        // leg初始化之后没拖动一个元素下来就+1,此值会一直++, 防止元素名称重复
        leg ++
        // 父级元素id = canvasWrap的网页可见区域上、左的距离
        let fatherY = canvasWrap.offsetTop
        let fatherX = canvasWrap.offsetLeft
  
        // 拖动元素距离网页可见区域上、左的距离
        let targetX =  event.clientX
        let targetY =  event.clientY
         // 获取dragstart事件传递的参数 注意：index为左侧属性栏的下标
        let index = JSON.parse(event.dataTransfer.getData('data'))
        let item = btns[index]
        // 清除dragstart事件传递的参数
        event.dataTransfer.clearData()
          // 需在这边添加增加的样式
        if (item.ControlType === 'line') { //line单独添加样式
          Controls.ControlList.push({
            title: item.title,
            ControlType: item.ControlType,
            Name: item.ControlType + leg,
            PropertyList: {
              id: leg,
              Left: targetX - fatherX,
              Top: targetY - fatherY,
              Opacity: item.Opacity,
              Style: item.Style,
              Color: item.Color,
              Width: item.Width,
              Height: item.Height,
              BorderWidth: item.BorderWidth,
              BorderColor: item.BorderColor,
              BackColor: item.BackColor,
              FontFamily: item.FontFamily,
              FontWeight: item.FontWeight,
              FontSize: item.FontSize,
              TextDecoration: item.TextDecoration,
              BorderRadius: item.BorderRadius,
              Img: item.Img,
              Text: item.Text,
              ZIndex: item.ZIndex
            },
            pointList: [ 'l', 'r'],
          })
        }else {
          Controls.ControlList.push({
            title: item.title,
            ControlType: item.ControlType,
            Name: item.ControlType + leg,
            PropertyList: {
              id: leg,
              Left: targetX - fatherX,
              Top: targetY - fatherY,
              Opacity: item.Opacity,
              Style: item.Style,
              Color: item.Color,
              Width: item.Width,
              Height: item.Height,
              BorderWidth: item.BorderWidth,
              BorderColor: item.BorderColor,
              BackColor: item.BackColor,
              FontFamily: item.FontFamily,
              FontWeight: item.FontWeight,
              FontSize: item.FontSize,
              TextDecoration: item.TextDecoration,
              BorderRadius: item.BorderRadius,
              Placeholder: item.Placeholder,
              TextAlign: item.TextAlign,
              Img: item.Img,
              Text: item.Text,
              ZIndex: item.ZIndex
            },
            pointList: ['lt', 'rt', 'lb', 'rb', 'l', 'r', 't', 'b'],
          })
        }
        // 此处添加数据
        if (item.ControlType === 'datatextblock') { // 数值显示数据
          let data = {
            Variate: '',
          } 
          Object.assign(Controls.ControlList[Controls.ControlList.length - 1],data) 
        }
        item.Left = targetX - fatherX
        item.Top = targetY - fatherY
        rightCommon(item.title, item.ControlType + leg, Controls.ControlList.length - 1)
        // Controls.ControlList.length - 1 从源对象拖放到画布上的生成的元素永远是Controls.ControlList数组的最后一位
        changeCommon(item, Controls.ControlList.length - 1)
        childElement(Controls.ControlList.length - 1)
        }, false)
    }
    function clickWrap (e) {
      e.preventDefault()
      if (e.target.id && e.target.id === 'wrap') {
        initCommon()
      }
    }
      // 鼠标点击可以的按钮resize事件
    function handleMouseDownOnPoint (point, event, type, index) {
      let downEvent = event
      // 抛出事件让父组件设置当前元素选中状态
      downEvent.stopPropagation()
      downEvent.preventDefault() // Let's stop this event.
      const pos = {...Controls.ControlList[index].PropertyList}
      let Height = pos.Height
      let Width = pos.Width
      let Top = pos.Top
      let Left = pos.Left
      let startX = downEvent.clientX
      let startY = downEvent.clientY
      // 当前模块的最小宽度值
      let minWidth = 0
      if (pos.minWidth) {
        minWidth = pos.minWidth
      }
      // 当前模块的最小高度值
      let minHeight = 0
      if (pos.minHeight) {
        minHeight = pos.minHeight
      }
      let move = moveEvent => {
        let currX = moveEvent.clientX
        let currY = moveEvent.clientY
        let disY = currY - startY
        let disX = currX - startX
        let hasT = /t/.test(point)
        let hasB = /b/.test(point)
        let hasL = /l/.test(point)
        let hasR = /r/.test(point)
        let newHeight = + Height + (hasT ? -disY : hasB ? disY : 0)
        let newWidth = + Width + (hasL ? -disX : hasR ? disX : 0)
        pos.Width = newWidth > 0 ? newWidth : 0
        pos.Left = + Left + (hasL ? disX : 0)
        pos.Top = + Top + (hasT ? disY : 0)
        pos.ZIndex = 20
        // console.log(pos.left)
        // console.log(pos.top)
        // 拖动类型为文本则不可改变高度
        if (type !== 'text') {
          pos.Height = newHeight > 0 ? newHeight : 0
        }
        if (Controls.ControlList[index].ControlType === 'line' && pos.Width < 10 ) {
          pos.Width = 10
          return
        } 
        // 如果宽度小于最小宽度就直接返回
        if (pos.Width < minWidth) return
        // 如果高度小于最小高度就直接返回
        if (pos.Height < minHeight) return
        resize(pos, index)
        // this.$emit('resize', pos, index)
      }
      let up = () => {
        Controls.ControlList[index].PropertyList.ZIndex = 10
        setClass(index)
        document.removeEventListener('mousemove', move)
        document.removeEventListener('mouseup', up)
      }
      document.addEventListener('mousemove', move)
      document.addEventListener('mouseup', up)
    }
    function resize (pos, index) {
      if (Controls.ControlList[index]) {
        Controls.ControlList[index].PropertyList = pos
        childElement(index)
        changeCommon({...pos, ControlType: Controls.ControlList[index].ControlType} , index)
      }
    }
    // 画布禁止鼠标右键点击
    function forbidMouse(e) {
      e.preventDefault()
    }
    // 创建生成画布元素
    function childElement (index) {
        let html = ''
        let wrap = document.getElementById('wrap')
        if (Controls.ControlList.length !== 0) {
          Controls.ControlList.forEach((item, index) => {
            if (item.ControlType === 'solidrectangle') {  //矩形样式
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;
              border-style: ${item.PropertyList.Style}; border-color: ${item.PropertyList.BorderColor}; border-width: ${item.PropertyList.BorderWidth}px;
              background-color: ${item.PropertyList.BackColor}; height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};
              opacity: ${Number(item.PropertyList.Opacity) / 100};">
                <div class="moduleShape"></div>
              </div>
              `
            } else if (item.ControlType === 'line') {  //直线样式
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px; z-index: ${item.PropertyList.ZIndex};
              border-top-style: ${item.PropertyList.Style}; border-top-color: ${item.PropertyList.BorderColor}; border-top-width: ${item.PropertyList.BorderWidth}px;
              opacity: ${Number(item.PropertyList.Opacity) / 100};">
              <div class="moduleShape">
                </div>
              </div>
              `
            } else if (item.ControlType === 'staticimage' || item.ControlType === 'image') {  //静态图片和动态图片
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};opacity: ${Number(item.PropertyList.Opacity) / 100};">
                <img class="moduleShape" src="${item.PropertyList.Img}" alt="图片" />
              </div>
              `
            } else if (item.ControlType === 'datatextblock') {  //数值显示
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};opacity: ${Number(item.PropertyList.Opacity) / 100}; 
              border-style: ${item.PropertyList.Style};border-color: ${item.PropertyList.BorderColor}; border-width: ${item.PropertyList.BorderWidth}px; 
              font-family: ${item.PropertyList.FontFamily};font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration}"
              >
              <span class="moduleShape numShow" style="font-family: ${item.PropertyList.FontFamily};font-size: ${item.PropertyList.FontSize}px" >
                数值显示
              </span>
              </div>
              `
            } else if (item.ControlType === 'statictextblock') {  //静态文本
              // <input class="moduleShape common-input" style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
              //   font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" onblur="handleblur(event, ${index}, 'Text')" 
              //   value="${item.PropertyList.Text}"
              // />
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height}px;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};opacity: ${Number(item.PropertyList.Opacity) / 100};
              border: none"
              >
              <div class="moduleShape common-input" contenteditable="true" style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
                font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" onblur="handleblur(event, ${index}, 'Text')" >
                <span>${item.PropertyList.Text}</span>
              </div>
              </div>
              `
            } else if(item.ControlType ===  'dynamictext') {  //动态文本
              // <input class="moduleShape common-input" style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
              //   font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" onblur="handleblur(event, ${index}, 'Text')" 
              //   value="${item.PropertyList.Text}"
              // />
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height}px;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};opacity: ${Number(item.PropertyList.Opacity) / 100};
              border: none"
              >
              <div class="moduleShape common-input" contenteditable="true" style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
                font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily}; text-align:${item.PropertyList.TextAlign}" onblur="handleblur(event, ${index}, 'Text')" >
                <span>${item.PropertyList.Text}</span>
              </div>
              </div>
              `
            } else if (item.ControlType ===  'solidellipse') { //圆形
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;border-radius: 50%;
              border-style: ${item.PropertyList.Style}; border-color: ${item.PropertyList.BorderColor}; border-width: ${item.PropertyList.BorderWidth}px;
              background-color: ${item.PropertyList.BackColor}; height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};
              opacity: ${Number(item.PropertyList.Opacity) / 100};">
                <div class="moduleShape">
                </div>
              </div>
              `
            } else if (item.ControlType === 'ellipselamp') {  //圆形状态灯
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;border-radius: 50%;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};background-color: #DDDDDD;
              opacity: ${Number(item.PropertyList.Opacity) / 100};">
                <div class="moduleShape">
                </div>
              </div>
              `
            } else if (item.ControlType === 'commonlamp') { //矩形状态灯
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;border-radius: ${item.PropertyList.BorderRadius}px;
              height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};background-color: #DDDDDD;
              opacity: ${Number(item.PropertyList.Opacity) / 100};">
                <div class="moduleShape">
                </div>
              </div>
              `
            } else if (item.ControlType === 'cornerbutton') { //控制按钮
              html += `<div class="commonModule div-btn" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height - (item.PropertyList.BorderWidth * 2)}px;height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};border-width: ${item.PropertyList.BorderWidth}px;border-style: ${item.PropertyList.Style};border-color: ${item.PropertyList.BorderColor};background: ${item.PropertyList.BackColor}; text-align: ${item.PropertyList.TextAlign}; border-radius: ${item.PropertyList.BorderRadius}px; opacity: ${Number(item.PropertyList.Opacity) / 100};">
              <div class="moduleShape common-input" contenteditable="true"  style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
                font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" onblur="handleblur(event, ${index}, 'Text')" >
                <span>${item.PropertyList.Text}</span>
              </div>
              </div>`
            } else if (item.ControlType === 'rwtextbox') {  //读写框
              html += `<div class="commonModule div-text" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height - (item.PropertyList.BorderWidth * 2)}px;height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};border-width: ${item.PropertyList.BorderWidth}px;border-style: ${item.PropertyList.Style};border-color: ${item.PropertyList.BorderColor};background: ${item.PropertyList.BackColor}; text-align: ${item.PropertyList.TextAlign}; border-radius: ${item.PropertyList.BorderRadius}px; opacity: ${Number(item.PropertyList.Opacity) / 100};">
              <div class="moduleShape common-input" contenteditable="true"  style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
                font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" onblur="handleblur(event, ${index}, 'Text')" >
                <span>${item.PropertyList.Text}</span>
              </div>
              </div>`
            } else if (item.ControlType === 'jumplink') { //跳转链接
              html += `<div class="commonModule div-text" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height}px;height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};background: ${item.PropertyList.BackColor};  opacity: ${Number(item.PropertyList.Opacity) / 100};">
              <div class="moduleShape common-input"  style="font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration};
                font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" >
                <span>跳转链接 ></span>
              </div>
              </div>`
            } else if (item.ControlType === 'textsearch') { //文本查询
              html += `<div class="commonModule" draggable="false" data-id="${index}"
                onmousedown="handleDown(event)" onclick="setClass(${index})" oncontextmenu="openRightMenu(event,${index})"
              style="left: ${item.PropertyList.Left}px;top: ${item.PropertyList.Top}px; width: ${item.PropertyList.Width}px;line-height: ${item.PropertyList.Height - (item.PropertyList.BorderWidth * 2)}px;height: ${item.PropertyList.Height}px;z-index: ${item.PropertyList.ZIndex};background: ${item.PropertyList.BackColor}; text-align: ${item.PropertyList.TextAlign};  opacity: ${Number(item.PropertyList.Opacity) / 100};">
              <input class="search-input" style="width: ${item.PropertyList.Width}px;height: ${item.PropertyList.Height}px;border-width: ${item.PropertyList.BorderWidth}px;border-style: ${item.PropertyList.Style};border-color: ${item.PropertyList.BorderColor};border-radius: ${item.PropertyList.BorderRadius}px;text-align: ${item.PropertyList.TextAlign};font-weight: ${item.PropertyList.FontWeight};text-decoration: ${item.PropertyList.TextDecoration}; font-size: ${item.PropertyList.FontSize}px;font-family: ${item.PropertyList.FontFamily};" placeholder="${item.PropertyList.Placeholder}"
              value="${item.PropertyList.Text}" onblur="changeText(event, ${index}, 'Text')" />
              </div>`
            }
          })
        }
        // wrap.insertAdjacentHTML('afterend',html)   insertAdjacentHTML方法往html中插入模板字符串
        wrap.innerHTML = html
        if (index) {
          setClass(index)
        }
    }
    // 右侧属性栏初始化
    function initCommon () {
      let commonGroup = document.getElementById('common-group')
      let changeGroup = document.getElementById('change-group')
      let commonStr = `<div class="r-item" >检视: <span id="r-item-title">${commonList.Title}</span></div>
        <input type="text" class="r-input" onblur="setCanvasName(event)" value="${commonList.Name}" />
        <div class="r-btns">
          <div id="r-btns-style" class="active" onclick="choice('style')" >样 式</div>
          <div id="r-btns-event" onclick="choice('event')">数 据</div>
        </div>`
        let changeStr = `<div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
        `
        commonGroup.innerHTML = commonStr
        changeGroup.innerHTML = changeStr
        var list = [...document.getElementsByClassName('commonModule')]
        list.forEach((item) => {
          item.classList.remove("activeItem")
        })
        var childs = [...document.getElementsByClassName('edit-shape-point')]
        childs.forEach(item => {
          item.parentNode.removeChild(item)
        })
    }
    // 右侧属性栏公共样式
    function rightCommon (title, name, index) {
      let commonGroup = document.getElementById('common-group')
      let commonStr = `<div class="r-item" >检视: <span id="r-item-title">${title}</span></div>
        <input type="text" class="r-input" onblur="handleblur(event, ${index}, 'Name')" value="${name}" />
        <div class="r-btns">
          <div id="r-btns-style" class="active" onclick="choice('style', ${index})" >样 式</div>
          <div id="r-btns-event" onclick="choice('event', ${index})">数 据</div>
        </div>`
        commonGroup.innerHTML = commonStr
    }
    // 右侧属性栏变化样式
    function changeCommon (data, index) {
      let changeGroup = document.getElementById('change-group')
      let changeStr = ''
      if (data.ControlType === 'solidrectangle'){  //矩形样式
        changeStr = `<div class="pos-group" >
          <div class="r-pos"><span>尺寸</span> </div>
          <div class="r-pos r-pos-detail">
            <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
            <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
          </div>
          <div class="r-pos r-pos-detail">
            <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
            <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
          </div>
          </div>
          <div class="pos-others">
          <span>填充</span>
          <span class="pos-back-color"></span>
          </div>
          <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div>
          <div class="pos-others">
            <span class="pos-border">边框</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
            <span class="pos-border-color"></span>
            <span class="pos-border-style" onclick="changeColor(event, ${index}, 'Style')"></span>
          </div>
          <div class="pos-others">
            <span>不透明度(%)</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
          </div>`
      } else if (data.ControlType === 'line') { //直线样式
        changeStr = `<div class="pos-group" >
          <div class="r-pos">位置，<span>尺寸</span> </div>
          <div class="r-pos r-pos-detail">
            <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
          </div>
          <div class="r-pos r-pos-detail">
            <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
            <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
          </div>
          </div>
          <div class="pos-others">
          <span class="pos-border">边框</span>
          <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
          <span class="pos-border-color"></span>
          <span class="pos-border-style" onclick="changeColor(event, ${index}, 'Style')"></span>
        </div>
        <div class="pos-others">
          <span>不透明度(%)</span>
          <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
        </div>`
      } else if (data.ControlType === 'staticimage' || data.ControlType === 'image') {  //静态图片和动态图片
        changeStr =`<div class="pos-group" >
          <div class="r-pos">位置，<span>尺寸</span> </div>
          <div class="r-pos r-pos-detail">
            <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
            <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
          </div>
          <div class="r-pos r-pos-detail">
            <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
            <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
          </div>
          </div>
          <div class="pos-others">
          <span>不透明度(%)</span>
          <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
          </div>`
          if (data.ControlType === 'staticimage') {
            changeStr +=`<div class="pos-others">
            <span>图片</span>
            <select id="group" class="pos-select" onchange="changeImg(this[selectedIndex].value, ${index})" value="img1">
              <option value="img1">img1</option>
              <option value="img2">img2</option>
            </select>
            <span class="pos-selectImg">...</span>
          </div>`
        }
      } else if (data.ControlType === 'datatextblock') {  //数值显示
          changeStr += `<div class="pos-group" >
          <div class="r-pos">位置，<span>尺寸</span> </div>
          <div class="r-pos r-pos-detail">
            <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
            <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
          </div>
          <div class="r-pos r-pos-detail">
            <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
            <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
          </div>
          </div>
          <div class="pos-group" >
              <div class="r-pos r-pos-font">
                <span>字体</span>
                <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                  <option value="微软雅黑">微软雅黑</option>
                  <option value="宋体">宋体</option>
                </select>
            </div>
              <div class="r-pos r-font-prop">
                <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
                <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
                <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
                <span class="r-font-color"></span>
              </div>
            </div>
            <div class="pos-others">
              <span>填充</span>
              <span class="pos-back-color"></span>
            </div>
            <div class="pos-others">
              <span class="pos-border">阴影</span>
              <div class="font-border">
                <span class="font-border-color" title="内阴影" ></span>
                <span class="font-border-color" title="内阴影"></span>
              </div>
            </div>
            <div class="pos-others">
              <span class="pos-border">边框</span>
              <div class="font-border">
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
                <span class="font-border-color"></span>
              </div>
            </div>
            <div class="pos-others">
              <span>不透明度(%)</span>
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
            </div>
            `
        } else if (data.ControlType === 'statictextblock') {  //静态文本
          changeStr += `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
              <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
            </div>
            <div class="pos-group" >
                <div class="r-pos r-pos-font">
                  <span>字体</span>
                  <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                    <option value="微软雅黑">微软雅黑</option>
                    <option value="宋体">宋体</option>
                  </select>
              </div>
                <div class="r-pos r-font-prop">
                  <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
                  <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
                  <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
                  <span class="r-font-color"></span>
                </div>
              </div>
              <div class="pos-others">
                <span>填充</span>
                <span class="pos-back-color"></span>
              </div>
              <div class="pos-others">
                <span>不透明度(%)</span>
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
              </div>
              `
        } else if (data.ControlType === 'dynamictext') {  //动态文本
          changeStr += `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
              <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
            </div>
            <div class="pos-group" >
                <div class="r-pos r-pos-font">
                  <span>字体</span>
                  <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                    <option value="微软雅黑">微软雅黑</option>
                    <option value="宋体">宋体</option>
                  </select>
              </div>
                <div class="r-pos r-font-prop">
                  <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
                  <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
                  <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
                  <span class="r-font-color"></span>
                </div>
              </div>
              <div class="pos-group" >
                <div class="r-pos aligin-style-span">
                  <span>对齐方式</span>
                  <div class="r-pos r-align-style">
                    <i class="iconfont iconzuoduiqi" style=" ${data.TextAlign ==='left'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'left')" title="左对齐"></i>
                    <i class="iconfont iconjuzhongduiqi" style=" ${data.TextAlign ==='center'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'center')" title="居中对齐"></i>
                    <i class="iconfont iconyouduiqi" style=" ${data.TextAlign ==='right'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'right')" title="右对齐"></i>
                  </div>
                </div>
              </div>
              <div class="pos-others">
                <span>不透明度(%)</span>
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
              </div>
              `
        } else if (data.ControlType ===  'solidellipse') { //圆形
          changeStr = `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
              <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
            </div>
            <div class="pos-others">
              <span>填充</span>
              <span class="pos-back-color"></span>
            </div>
            <div class="pos-others">
              <span class="pos-border">阴影</span>
              <div class="font-border">
                <span class="font-border-color" title="内阴影" ></span>
                <span class="font-border-color" title="内阴影"></span>
              </div>
            </div>
            <div class="pos-others">
              <span class="pos-border">边框</span>
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
              <span class="pos-border-color"></span>
              <span class="pos-border-style" onclick="changeColor(event, ${index}, 'Style')"></span>
            </div>
            <div class="pos-others">
              <span>不透明度(%)</span>
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
            </div>`
        } else if (data.ControlType === 'ellipselamp') {  //圆形状态灯
          changeStr = `<div class="pos-group" >
              <div class="r-pos">位置，<span>尺寸</span> </div>
              <div class="r-pos r-pos-detail">
                <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
                <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
              </div>
              <div class="r-pos r-pos-detail">
                <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
              </div>
              </div>
              <div class="pos-others">
                <span class="pos-border">阴影</span>
                <div class="font-border">
                  <span class="font-border-color" title="内阴影" ></span>
                  <span class="font-border-color" title="内阴影"></span>
                </div>
              </div>
              <div class="pos-others">
                <span>不透明度(%)</span>
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
              </div>`
        } else if (data.ControlType === 'commonlamp') {  //矩形状态灯
          changeStr = `<div class="pos-group" >
              <div class="r-pos">位置，<span>尺寸</span> </div>
              <div class="r-pos r-pos-detail">
                <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
                <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
              </div>
              <div class="r-pos r-pos-detail">
                <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
              </div>
              </div>
              <div class="pos-others">
                <span>圆角</span>
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderRadius')" value="${data.BorderRadius}" />
              </div>
              <div class="pos-others">
                <span class="pos-border">阴影</span>
                <div class="font-border">
                  <span class="font-border-color" title="内阴影" ></span>
                  <span class="font-border-color" title="内阴影"></span>
                </div>
              </div>
              <div class="pos-others">
                <span>不透明度(%)</span>
                <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
              </div>`
        } else if (data.ControlType === 'cornerbutton') { //控制按钮
          // <div class="pos-group" >
          //   <div class="r-pos r-pos-font">
          //     <span>字体</span>
          //     <input class="pos-select pos-input" onblur="changeText(event, ${index}, 'Text')" value=${data.Text} />
          //   </div>
          // </div>
          changeStr = `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                <option value="微软雅黑">微软雅黑</option>
                <option value="宋体">宋体</option>
              </select>
            </div>
            <div class="r-pos r-font-prop">
              <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
              <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
              <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
              <span class="r-font-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
          <div class="pos-group" >
            <div class="r-pos aligin-style-span">
              <span>对齐方式</span>
              <div class="r-pos r-align-style">
                <i class="iconfont iconzuoduiqi" style=" ${data.TextAlign ==='left'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'left')" title="左对齐"></i>
                <i class="iconfont iconjuzhongduiqi" style=" ${data.TextAlign ==='center'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'center')" title="居中对齐"></i>
                <i class="iconfont iconyouduiqi" style=" ${data.TextAlign ==='right'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'right')" title="右对齐"></i>
              </div>
            </div>
          </div>
          <div class="pos-others">
            <span class="pos-border">边框</span>
            <div class="font-border">
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
              <span class="font-border-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>圆角</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderRadius')" value="${data.BorderRadius}" />
          </div>
          <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>不透明度(%)</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
          </div>`
        } else if (data.ControlType === 'rwtextbox') { //读写框
          changeStr = `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                <option value="微软雅黑">微软雅黑</option>
                <option value="宋体">宋体</option>
              </select>
            </div>
            <div class="r-pos r-font-prop">
              <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
              <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
              <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
              <span class="r-font-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
          <div class="pos-group" >
            <div class="r-pos aligin-style-span">
              <span>对齐方式</span>
              <div class="r-pos r-align-style">
                <i class="iconfont iconzuoduiqi" style=" ${data.TextAlign ==='left'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'left')" title="左对齐"></i>
                <i class="iconfont iconjuzhongduiqi" style=" ${data.TextAlign ==='center'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'center')" title="居中对齐"></i>
                <i class="iconfont iconyouduiqi" style=" ${data.TextAlign ==='right'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'right')" title="右对齐"></i>
              </div>
            </div>
          </div>
          <div class="pos-others">
            <span class="pos-border">边框</span>
            <div class="font-border">
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
              <span class="font-border-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>圆角</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderRadius')" value="${data.BorderRadius}" />
          </div>
          <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>不透明度(%)</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
          </div>`
        } else if (data.ControlType === 'jumplink') {
          changeStr = `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <input class="pos-select pos-input" onblur="changeText(event, ${index}, 'Text')" value=${data.Text} />
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                <option value="微软雅黑">微软雅黑</option>
                <option value="宋体">宋体</option>
              </select>
            </div>
            <div class="r-pos r-font-prop">
              <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
              <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
              <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
              <span class="r-font-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
          `
        } else if (data.ControlType === 'textsearch') { //文本查询)
          // <div class="pos-others">
          //   <span class="pos-border">边框</span>
          //   <div class="font-border">
          //     <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
          //     <span class="font-border-color"></span>
          //   </div>
          // </div>
          changeStr = `<div class="pos-group" >
            <div class="r-pos">位置，<span>尺寸</span> </div>
            <div class="r-pos r-pos-detail">
              <div><span>W：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Width')" value="${data.Width}" ></div>
              <div><span>H：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Height')" value="${data.Height}"></div>
            </div>
            <div class="r-pos r-pos-detail">
              <div><span>X：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Top')" value="${data.Top}" ></div>
                <div><span>Y：</span><input class="r-pos-input" type="text" onblur="handleblur(event, ${index}, 'Left')" value="${data.Left}"></div>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>字体</span>
              <select id="group" class="pos-select" onchange="changeFamily(this[selectedIndex].value, ${index})" value="${data.FontFamily}">
                <option value="微软雅黑">微软雅黑</option>
                <option value="宋体">宋体</option>
              </select>
            </div>
            <div class="r-pos r-font-prop">
              <span class="f-font-blod" onClick="changeFont(event, ${index}, 'FontWeight')">B</span>
              <span class="f-font-underline" onClick="changeFont(event, ${index}, 'TextDecoration')">U</span>
              <span><input class="r-pos-input r-font-input" style="margin-top: -2px;" type="text" onblur="handleblur(event, ${index}, 'FontSize')" value="${data.FontSize}"></span>
              <span class="r-font-color"></span>
            </div>
          </div>
          <div class="pos-others">
            <span>填充</span>
            <span class="pos-back-color"></span>
          </div>
          <div class="pos-others">
            <span class="pos-border">边框</span>
            <div class="font-border">
              <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderWidth')" value="${data.BorderWidth}" />
              <span class="font-border-color"></span>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos aligin-style-span">
              <span>对齐方式</span>
              <div class="r-pos r-align-style">
                <i class="iconfont iconzuoduiqi" style=" ${data.TextAlign ==='left'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'left')" title="左对齐"></i>
                <i class="iconfont iconjuzhongduiqi" style=" ${data.TextAlign ==='center'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'center')" title="居中对齐"></i>
                <i class="iconfont iconyouduiqi" style=" ${data.TextAlign ==='right'? 'border: 1px solid #fff; background: #404040' : '' }" onClick="changeTextAlign(event, ${index}, 'right')" title="右对齐"></i>
              </div>
            </div>
          </div>
          <div class="pos-others">
            <span>圆角</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'BorderRadius')" value="${data.BorderRadius}" />
          </div>
          <div class="pos-others">
            <span class="pos-border">阴影</span>
            <div class="font-border">
              <span class="font-border-color" title="内阴影" ></span>
              <span class="font-border-color" title="内阴影"></span>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>匹配模式</span>
              <select id="group" class="pos-select" value="1">
                <option value="1">模式一</option>
                <option value="2">模式二</option>
              </select>
            </div>
          </div>
          <div class="pos-group" >
            <div class="r-pos r-pos-font">
              <span>提示内容</span>
              <input class="pos-select pos-input" onblur="changeText(event, ${index}, 'Placeholder')" value=${data.Placeholder} />
            </div>
          </div>
          <div class="pos-others">
            <span>不透明度(%)</span>
            <input type="text" class="r-pos-input" onblur="handleblur(event, ${index}, 'Opacity')" value="${data.Opacity}" />
          </div>`
        }
      changeGroup.innerHTML = changeStr
    }
    function choice (type, index) {
      let style = document.getElementById('r-btns-style')
      let event = document.getElementById('r-btns-event')
      let changeGroup = document.getElementById('change-group')
      if (type === 'style') {
        if (index !== undefined) { //判断是否为画布， 若为画布则直接initCommon
          changeCommon({...Controls.ControlList[index].PropertyList, ControlType: Controls.ControlList[index].ControlType}, index)
          setClass(index)
          style.className += ' active'
          event.classList.remove("active")
        } else {
          initCommon()
        }
      } else {  // 此处为选中元素之后赋予样式
        event.className += ' active'
        style.classList.remove("active")
        let html = ``
        // changeGroup.innerHTML = ''
        if (Controls.ControlList[index].ControlType === 'datatextblock') {//数值显示
            html += `<div class="data" >
            <div class="data-func" >
              <span>功能设置</span>
                  <div class="func-variable">
                    <span class="func-wrap-title" >变量</span>
                    <div class="func-wrap-center">
                      <input type="text" class="func-wrap-input" disabled value="${Controls.ControlList[index].Variate}"  />
                      <span class="func-wrap-choice" onclick="openPop(${index})" >选择</span>
                    </div>
                    <span class="func-wrap-last" >${Controls.ControlList[index].Variate ? 1 : 0}/1</span>
                  </div>
                  <div class="func-others" ><input type="checkbox" id="label1" ><label for="label1">双击时弹出历史曲线窗口</label></div>
                  <div class="func-others" ><input type="checkbox" id="label2" ><label for="label2">数值字体颜色按条件变化</label> </div>
              <div>
                <div class="func-condition" >
                  <span>指定条件</span>
                  <i class="iconfont icontianjiajiahaowubiankuang" onclick="openAddition()" ></i>
                </div>
                <div class="func-table">
                  <table  cellspacing="0" cellpadding="0" border="0" >
                    <tbody>
                      <tr>
                        <td rowspan="1" colspan="1"><div>1</div></td>  
                        <td rowspan="1" colspan="1"><div>tag_1</div></td>  
                        <td rowspan="1" colspan="1"><div>>=</div></td>  
                        <td rowspan="1" colspan="1"><div>1</div></td>  
                        <td rowspan="1" colspan="1"><div class="table-back-color"><span style="background: green" ></span></div></td>  
                      </tr>
                      <tr>
                        <td rowspan="1" colspan="1"><div>1</div></td>  
                        <td rowspan="1" colspan="1"><div>tag_1</div></td>  
                        <td rowspan="1" colspan="1"><div>>=</div></td>  
                        <td rowspan="1" colspan="1"><div>1</div></td>  
                        <td rowspan="1" colspan="1"><div class="table-back-color"><span></span></div></td>  
                      </tr>
                    </tbody>
                  </table>
                </div> 
              </div>
              <div class="func-format">
                <span class="func-format-title" >显示格式</span>
                <input type="text" class="func-format-input" placeholder="整数位数" />
                <input type="text" class="func-format-input" placeholder="小数位数" />
              </div>
            </div>
          </div>`
        }
        changeGroup.innerHTML = html
      }
    }
    function choiceRow (event, i, index) {
      var list = document.getElementsByName("pop-check");
      if (event.target.checked === true) {
          list.forEach(item => {
            item.checked = false
          })
          event.target.checked = true
          Controls.ControlList[index].Variate = tableData[i].data2
        } else {
          Controls.ControlList[index].Variate = ''
        }
    }
    // 打开添加条件弹窗
    function openAddition () {
      let additionPop = document.getElementById('additionPop')
      additionPop.style.display = 'block'
    }
    // 关闭添加条件弹窗
    function closeAddtion () {
      let additionPop = document.getElementById('additionPop')
      additionPop.style.display = 'none'
    }
    // 打开弹窗
    function openPop (index) {
      tableData = [
        {
          data1: '基础采集点',
          data2: 'channeng1',
          data3: '产能1',
          data4: 'KW/h',
          data5: 'int',
          data6: '计算累计',
          data7: '力源',
          data8: 'Q102',
          data9: 'SYC20200305',
        },
        {
          data1: '基础采集点1',
          data2: 'bianliang2',
          data3: '变量2',
          data4: 'KW/h',
          data5: 'float',
          data6: '计算瞬时',
          data7: '力源',
          data8: 'Q102',
          data9: 'SYC20200305',
        }
      ]
      let popup = document.getElementById('popup')
      let tbody = document.getElementById('popup-tbody')
      let html = ``
      popup.style.display = 'block'
      tableData.forEach((item,i) => {
        html += `<tr>
          <td rowspan="1" colspan="1"><div><input type="checkbox" name="pop-check" ${Controls.ControlList[index].Variate === item.data2 ? 'checked' : ''} onchange="choiceRow(event, ${i}, ${index})" ></div></td>
          <td rowspan="1" colspan="1"><div>${item.data1}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data2}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data3}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data4}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data5}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data6}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data7}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data8}</div></td>
          <td rowspan="1" colspan="1"><div>${item.data9}</div></td>
        </tr>`
      })
      tbody.setAttribute('data-index', index)
      tbody.innerHTML = html
    }
    // 关闭弹窗
    function closePopup (e) {
      let popup = document.getElementById('popup')
      popup.style.display = 'none'
    }
    // 提交
    function confirmPop () {
      let popup = document.getElementById('popup')
      let tbody = document.getElementById('popup-tbody') 
      popup.style.display = 'none'
      choice('data', tbody.dataset.index)
    }
    function setClass (i) {
      var list = [...document.getElementsByClassName('commonModule')]
      var str = ``
      list.forEach((item) => {
        if (item.dataset.id == i) { // 注意：此处用== 不用===
          item.className += ' activeItem'
          if (Controls.ControlList[i].pointList && Controls.ControlList[i].pointList.length !== 0) {
            Controls.ControlList[i].pointList.forEach((p) => {
              // str += `<div class="edit-shape-point"> </div>`
              let style = getPointStyle(p, i)
              str += `<div class="edit-shape-point" onmousedown="handleMouseDownOnPoint('${p}',event, 'div', ${i})" style="left: ${style.left};top: ${style.top};margin-left: ${style.marginLeft};margin-top: ${style.marginTop};
               cursor: ${style.cursor}"> </div>`
            })
          }
          item.insertAdjacentHTML('beforeend', str) 
          // item.innerHTML = str
        } else {
          item.classList.remove("activeItem")
          item.classList.remove("edit-shape-point")
          let child = [...item.children]
          child.forEach(item => {
            if (item.className === 'edit-shape-point') {
              item.parentNode.removeChild(item)
            }
          })
        }
      })
    }
    function getPointStyle (point, index) {
      return this.convertPointStyle(point, Controls.ControlList[index].PropertyList, index)
    }
    // 绘制8个小圆点
    function convertPointStyle (point, defaultStyle, index, directionKey = {t: 'n', b: 's', l: 'w', r: 'e'}, ) {
      const pos = defaultStyle
      const height = pos.Height
      const width = pos.Width
      const borderWidth = pos.BorderWidth
      let hasT = /t/.test(point)
      let hasB = /b/.test(point)
      let hasL = /l/.test(point)
      let hasR = /r/.test(point)
      let newLeft = 0
      let newTop = 0
      if (Controls.ControlList[index].ControlType === 'line') { // 当元素为直线时特殊处理
        if (point.length === 2) {
          newLeft = hasL ? 0 : width
          newTop = hasT ? 0 : borderWidth * 2
          // 当有border-Width时需要减去borderWidth的大小
          if (borderWidth && borderWidth !== 0) {
            newLeft = newLeft - borderWidth
            newTop = newTop - borderWidth
          }
        } else {
          // !#zh 上下点，宽度固定在中间
          if (hasT || hasB) {
            newLeft = width / 2
            newTop = hasT ? 0 : borderWidth * 2
            // 当有border-Width时需要减去borderWidth的大小
            if (borderWidth && borderWidth !== 0) {
              newLeft = newLeft - borderWidth
              newTop = newTop - borderWidth
            }
          }
          // !#zh 左右点，高度固定在中间
          if (hasL || hasR) {
            newLeft = hasL ? 0 : width
            newTop = -borderWidth/2 - 5
            // 当有border-Width时需要减去borderWidth的大小
            // if (borderWidth && borderWidth !== 0) {
            //   newLeft = newLeft - borderWidth
            //   newTop = newTop - borderWidth
            // }
          }
        }
      }else if (Controls.ControlList[index].ControlType === 'textsearch') {
        if (point.length === 2) {
          newLeft = hasL ? 0 : width
          newTop = hasT ? 0 : height
        } else {
          // !#zh 上下点，宽度固定在中间
          if (hasT || hasB) {
            newLeft = width / 2
            newTop = hasT ? 0 : height
          }
          // !#zh 左右点，高度固定在中间
          if (hasL || hasR) {
            newLeft = hasL ? 0 : width
            newTop = height / 2
          }
        }
      }else {
        if (point.length === 2) {
          newLeft = hasL ? 0 : width
          newTop = hasT ? 0 : height
          // 当有border-Width时需要减去borderWidth的大小
          if (borderWidth && borderWidth !== 0) {
            newLeft = newLeft - borderWidth
            newTop = newTop - borderWidth
          }
        } else {
          // !#zh 上下点，宽度固定在中间
          if (hasT || hasB) {
            newLeft = width / 2
            newTop = hasT ? 0 : height
            // 当有border-Width时需要减去borderWidth的大小
            if (borderWidth && borderWidth !== 0) {
              newLeft = newLeft - borderWidth
              newTop = newTop - borderWidth
            }
          }
          // !#zh 左右点，高度固定在中间
          if (hasL || hasR) {
            newLeft = hasL ? 0 : width
            newTop = height / 2
            // 当有border-Width时需要减去borderWidth的大小
            if (borderWidth && borderWidth !== 0) {
              newLeft = newLeft - borderWidth
              newTop = newTop - borderWidth
            }
          }
        }
      }
      const style = {
        marginLeft: (hasL || hasR) ? '-5px' : 0,
        marginTop: (hasT || hasB) ? '-4px' : 0,
        left: `${newLeft}px`,
        top: `${newTop}px`,
        cursor: point.split('').reverse().map(m => directionKey[m]).join('') + '-resize'
      }
      return style
    }
    function handleDown (e) {
      // let index = e.target.dataset.id ? e.target.dataset.id : e.target.parentElement.dataset.id
      let index = e.currentTarget.dataset.id
      let childItem = Controls.ControlList[index]
      rightCommon(childItem.title, childItem.Name, index)
      changeCommon({...childItem.PropertyList, ControlType: childItem.ControlType}, index)
      const { PropertyList: pos } = childItem
      let startY = e.clientY
      let startX = e.clientX
      let startTop = Number(pos.Top)
      let startLeft = Number(pos.Left)
      let firstTime = ''
      let lastTime = ''
      let move = moveEvent => {
        // !#zh 移动的时候，不需要向后代元素传递事件，只需要单纯的移动就OK
        moveEvent.stopPropagation()
        moveEvent.preventDefault()
        let currX = moveEvent.clientX
        let currY = moveEvent.clientY
        pos.Top = currY - startY + startTop
        pos.Left = currX - startX + startLeft
        // this.styleObj.top = pos.Top + 'px'
        // this.styleObj.left = pos.Left + 'px'
        childItem.PropertyList.ZIndex = 20
        childItem.PropertyList.Top = pos.Top
        childItem.PropertyList.Left = pos.Left
        changeCommon({...childItem.PropertyList, ControlType: childItem.ControlType}, index)
        childElement()
      }
      let up = () => {
        lastTime = new Date().getTime()
        if ((lastTime - firstTime) > 200) {
          childItem.PropertyList.ZIndex = 10
          setClass(index)
        }
        document.removeEventListener('mousemove', move, true)
        document.removeEventListener('mouseup', up, true)
      }
      document.addEventListener('mousemove', move, true)
      document.addEventListener('mouseup', up, true)
      return true
    }
    function setCanvasName (e) {
      commonList.Name = e.target.value
      initCommon()
    } 
    function changeText (e, index, prop) {
      Controls.ControlList[index].PropertyList[prop] = e.target.value
      childElement()
      setClass(index)
    }
    function handleblur (e, index, prop) {
      // if (prop !== 'Name') {
      //   Controls.ControlList[index].PropertyList[prop] = e.target.value
      // } else {
      //   Controls.ControlList[index].Name = e.target.value
      // }
      
      if (prop === 'Name') {
        Controls.ControlList[index].Name = e.target.value
      } else if (prop === 'Text') {
        Controls.ControlList[index].PropertyList[prop] = e.target.innerText
      } else if (prop === 'BorderWidth') {
        Controls.ControlList[index].PropertyList[prop] = e.target.value
        setClass(index)
      } else {
        Controls.ControlList[index].PropertyList[prop] = e.target.value
      }
      childElement()
      setClass(index)
    }
    function changeColor (e, index, prop) {
      if (Controls.ControlList[index].PropertyList[prop] === 'solid') {
        Controls.ControlList[index].PropertyList[prop] = 'dashed'
      } else {
        Controls.ControlList[index].PropertyList[prop] = 'solid'
      }
      childElement()
      setClass(index)
    }
    function changeFont (e, index, prop) {
      if (prop === 'FontWeight') {
        if (Controls.ControlList[index].PropertyList[prop] === 'normal') {
          Controls.ControlList[index].PropertyList[prop] = 'bold'
        } else {
          Controls.ControlList[index].PropertyList[prop] = 'normal'
        }
      } else {
        if (Controls.ControlList[index].PropertyList[prop] === 'none') {
          Controls.ControlList[index].PropertyList[prop] = 'underline'
        } else {
          Controls.ControlList[index].PropertyList[prop] = 'none'
        }
      }
      childElement()
      setClass(index)
    }
    function changeTextAlign (e, index, align) {
      Controls.ControlList[index].PropertyList.TextAlign = align
      childElement()
      changeCommon({...Controls.ControlList[index].PropertyList,ControlType: Controls.ControlList[index].ControlType}, index)
      setClass(index)
    }
    function changeImg (value, index) {
      Controls.ControlList[index].PropertyList.Img = `./imgs/${value}.jpg`
      childElement()
      setClass(index)
    }
    function changeFamily(value, index) {
      Controls.ControlList[index].PropertyList.FontFamily = value
      childElement()
      setClass(index)
    }
    function openRightMenu (e, index) {
      e.preventDefault()
      menu.style.left = e.clientX + 'px';
      menu.style.top = e.clientY + 'px';
      //改变自定义菜单的宽，让它显示出来
      menu.style.display = 'block'
      delIndex = index
    }
     //关闭右键菜单，很简单
    window.onclick = function(e){
      //用户触发click事件就可以关闭了，因为绑定在window上，按事件冒泡处理，不会影响菜单的功能
        menu.style.display = 'none'
    }
    function delElement (event) {
      Controls.ControlList.splice(delIndex, 1)
      initCommon()
      childElement()
    }
  
  </script>
</body>
</html>